<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Ataques terroristas</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i"
          rel="stylesheet">
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="vendor/devicons/css/devicons.min.css" rel="stylesheet">
    <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">


    <!-- Custom styles for this template -->
    <link href="css/resume.css" rel="stylesheet">


</head>

<body id="page-top">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav" style="width: 150px">
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link js-scroll-trigger" href="#sobre">Sobre</a>
            </li>
            <li class="nav-item">
                <a class="nav-link js-scroll-trigger" href="#mapa">Mapa</a>
            </li>
            <li class="nav-item">
                <a class="nav-link js-scroll-trigger" href="#gráfico">Gráfico</a>
            </li>
        </ul>
    </div>
</nav>

<div class="container-fluid p-0">

    <section class="resume-section p-3 p-lg-5 d-flex d-column" id="sobre">
        <div class="my-auto">
            <h1 class="mb-0">Ataques
                <span class="text-primary">terroristas</span>
            </h1>
            <div class="subheading mb-5">Uma análise sobre mais de 170 mil ataques de
                <span class="text-primary">1970-2016</span>
            </div>
            <p class="mb-5"></p>

            <p class="mb-5">Alguns dados a letra grande como número de ataques total, ano com maior numero de
                ataques, média de ataques por ano, média de mortes por ano, média de mortes por ataque, pais com mais
                ataques, pais com mais mortes - analise pode ser feita no pandas em python
            </p>
            <ul class="list-inline list-social-icons mb-0">
                <li class="list-inline-item">
                    <a href="https://www.kaggle.com/START-UMD/gtd">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-database fa-stack-1x fa-inverse"></i>
                </span>
                    </a>
                </li>
            </ul>
        </div>
    </section>

    <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="mapa">
        <div class="my-auto">
            <h2 class="mb-5">mapa</h2>

            <div class="resume-item d-flex flex-column flex-md-row mb-5">
                <div class="resume-content mr-auto">
                    <h3 class="mb-0">Introdução sobre funcionalidades???</h3>
                    <div class="subheading mb-3">Intelitec Solutions</div>
                    <p>texto</p>
                </div>
            </div>
        </div>
        <div style="width: 100%; display: flex">
            <div id="vista-mapa" style="position: relative; width: 986px; height: 850px; float: left"></div>
            <div id="slider" name="slider" style="margin-left: 10px; height: 850px;"></div>
            <input type="text" class="min date" id="min" value="1800" readonly>
            <input type="text" class="max date" id="max" value="2015" readonly>
        </div>
        <div id="vista-mapa2" style="position: relative; width: 986px; height: 850px;"></div>
    </section>

    <section class="resume-section p-3 p-lg-5 d-flex flex-column" id="gráfico">
        <div class="my-auto">
            <h2 class="mb-5">gráfico</h2>

            <div class="resume-item d-flex flex-column flex-md-row mb-5">
                <div class="resume-content mr-auto">
                    <h3 class="mb-0">University of Colorado Boulder</h3>
                    <div class="subheading mb-3">Bachelor of Science</div>
                    <div>Computer Science - Web Development Track</div>
                    <p>GPA: 3.23</p>
                </div>
            </div>
        </div>
    </section>

</div>
<!-- Bootstrap core JavaScript -->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Plugin JavaScript -->
<script src="vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Custom scripts for this template -->
<script src="js/resume.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<!-- I recommend you host this file on your own, since this will change without warning -->
<script src="http://datamaps.github.io/scripts/datamaps.world.min.js?v=1"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>


<script>
    function processCountryNames(name) {
        switch (name) {
            case "United States":
                return "United States of America";
                break;
            case "Slovak Republic":
                return "Slovakia";
                break;
            case "Tanzania":
                return "United Republic of Tanzania";
                break;
            case "Guinea-Bissau":
                return "Guinea Bissau";
                break;
            case "Serbia":
                return "Republic of Serbia";
                break;
            case "Bosnia-Herzegovina":
                return "Bosnia and Herzegovina";
                break;
            case "Kosovo":
                return "Kosovo";
                break;
            case "Bahamas":
                return "The Bahamas";
                break;
            default:
                return name;
        }
    }

    function palette(min, max) {
        var d = (max - min) / 10;
        return d3.scale.threshold()
            .range(['#58fa58', '#a3fe30', '#d5ff00', '#ffff00', '#ffc400', '#ff8900', '#ff4000', '#ff2200', '#d70002', '#8b0000'])
            .domain([min + d, min + 2 * d, min + 3 * d, min + 4 * d, min + 5 * d, min + 6 * d, min + 7 * d, min + 8 * d, min + 9 * d, min + 10 * d]);
    }

    function decodeColor(colorCode) {
        return colorCode.replace("$", "#");
    }

    function codeColor(colorCode) {
        return colorCode.replace("#", "$");
    }

</script>
<svg width="960" height="500"></svg>
<script>
    var map1;
    var map2;
    var terroristData = {};
    var countries = Datamap.prototype.worldTopo.objects.world.geometries;
    var mapColors = {};
    var points = [];
    var filteredPoints;
    var years = [2016];
    var minAtacks = Number.MAX_SAFE_INTEGER;
    var maxAtacks = 0;

    d3.csv("relevant_terrorist.csv", function (data) {
        data.forEach(function (element) {
            if (element.latitude !== "" && element.longitude !== "" && element.nkill !== "" && element.nkill > 0.0) {
                var deaths = parseFloat(element.nkill);
                var raio = 1;

                if (deaths >= 1 && deaths <= 100) {
                    raio = 5.5;
                }

                if (deaths >= 101 && deaths <= 300) {
                    raio = 10;
                }

                else if (deaths >= 301 && deaths <= 601) {
                    raio = 15;
                }

                else if (deaths >= 602 && deaths <= 902) {
                    raio = 20;
                }

                else if (deaths >= 903 && deaths <= 1200) {
                    raio = 25;
                }

                else if (deaths > 1200) {
                    raio = 30;
                }

                points.push({
                    year: parseInt(element.iyear),
                    latitude: element.latitude,
                    longitude: element.longitude,
                    fillKey: 'pnt',
                    radius: raio,
                    nkills: deaths
                });
            }

            if (terroristData[processCountryNames(element.country_txt)] == null) {
                terroristData[processCountryNames(element.country_txt)] = [element];
            }

            else {
                terroristData[processCountryNames(element.country_txt)].push(element);
                var nrAtacks = terroristData[processCountryNames(element.country_txt)].length;
                if (nrAtacks > maxAtacks) {
                    maxAtacks = nrAtacks;
                }
                if (nrAtacks < minAtacks) {
                    minAtacks = nrAtacks;
                }
            }
        });

        var colorPicker = palette(minAtacks, maxAtacks + 1);
        for (var i = 0, j = countries.length; i < j; i++) {
            console.log(countries[i].properties.name);
            if (terroristData[countries[i].properties.name] != null) {
                mapColors[countries[i].id] = {fillKey: 'red'};
                if (terroristData[countries[i].properties.name] != null) {
                    mapColors[countries[i].id] = {
                        fillKey: codeColor(colorPicker(terroristData[countries[i].properties.name].length))
                    }
                }
                else {
                    mapColors[countries[i].id] = {fillKey: 'noData'}
                }
            }
        }

        map1 = new Datamap({
            scope: 'world',
            element: document.getElementById('vista-mapa2'),
            projection: 'mercator',
            fills: {
                noData: '#6E6E6E',
                $58fa58: '#58fa58',
                $a3fe30: '#a3fe30',
                $d5ff00: '#d5ff00',
                $ffff00: '#ffff00',
                $ffc400: '#ffc400',
                $ff8900: '#ff8900',
                $ff4000: '#ff4000',
                $ff2200: '#ff2200',
                $d70002: '#d70002',
                $8b0000: '#8b0000'
            },
            data: mapColors
        });

        map2 = new Datamap({
            scope: 'world',
            element: document.getElementById('vista-mapa'),
            projection: 'mercator',
            fills: {
                'pnt': 'red',
                noData: '#6E6E6E',
                $58fa58: '#58fa58',
                $a3fe30: '#a3fe30',
                $d5ff00: '#d5ff00',
                $ffff00: '#ffff00',
                $ffc400: '#ffc400',
                $ff8900: '#ff8900',
                $ff4000: '#ff4000',
                $ff2200: '#ff2200',
                $d70002: '#d70002',
                $8b0000: '#8b0000',
                green: '#ABDDA4'
            },
            data: mapColors
        });

        filteredPoints = points.filter(function (el) {
            return years.includes(parseInt(el.year));
        });

        map2.bubbles(filteredPoints, {
            fillOpacity: 0.5,
            borderWidth: 1,
            borderColor: '#990000',
            popupOnHover: false,
            highlightOnHover: false
        });
    });

    $min_input = $('#min');
    $max_input = $('#max');

    $slider = $('#slider').slider({
        orientation: 'vertical',
        animate: "fast",
        range: true,
        min: 1970,
        max: 2016,
        values: [2015, 2016],
        slide: function(event, ui) {
            adjust(ui.values[0], ui.values[1]);
        }
    });

    function adjust(min, max) {
        $min_input.val(min);
        $max_input.val(max);
        $slider.find('.ui-slider-handle:first-of-type').attr('data-content',min);
        $slider.find('.ui-slider-handle:last-of-type').attr('data-content',max);
    }

    var min = $slider.slider('values', 0);
    var max = $slider.slider('values', 1);
    adjust(min, max);
</script>

</body>

</html>

<!DOCTYPE html>
<meta charset="utf-8">
<svg width="960" height="500"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
  function processCountryNames(name){
    switch (name) {
      case "United States":
        return "United States of America";
        break;
      case "Slovak Republic":
        return "Slovakia";
        break;
      case "Tanzania":
        return "United Republic of Tanzania";
        break;
      case "Guinea-Bissau":
        return "Guinea Bissau";
        break;
      case "Serbia":
        return "Republic of Serbia";
        break;
      case "Bosnia-Herzegovina":
        return "Bosnia and Herzegovina";
        break;
      case "Kosovo":
        return "Kosovo";
        break;
      case "Bahamas":
        return "The Bahamas";
        break;
      default:
        return name;
    }
  }

  function palette(min, max) {
  var d = (max-min)/10;
  return d3.scale.threshold()
      .range(['#58fa58','#a3fe30','#d5ff00','#ffff00','#ffc400','#ff8900','#ff4000','#ff2200','#d70002','#8b0000'])
      .domain([min+1*d,min+2*d,min+3*d,min+4*d,min+5*d,min+6*d,min+7*d,min+8*d,min+9*d,min+10*d]);
  }
  function decodeColor(colorCode) {
    return colorCode.replace("$", "#");
  }

  function codeColor(colorCode) {
    return colorCode.replace("#", "$");
  }

  function getAttackArray(yearAtacks){
    var atackArray = [];
    for (var property in yearAtacks) {
        if (yearAtacks.hasOwnProperty(property)) {
          // do stuff
          atackArray.push({'year': property, 'nrAttacks': yearAtacks[property]})
        }
      }
      return atackArray;
    }
</script>

<script>

var svg = d3.select("svg"),
    margin = {top: 20, right: 20, bottom: 30, left: 50},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom,
    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");


var x = d3.scaleTime()
    .rangeRound([0, width]);

var y = d3.scaleLinear()
    .rangeRound([height, 0]);

var line = d3.line()
    .x(function(d) { return x(d.year); })
    .y(function(d) { return y(d.nrAttacks); });

var terroristData = {};
var countryAtacks = {};
d3.csv("relevant_terrorist.csv", function(data){
  data.forEach(function(element) {
    if(terroristData[processCountryNames(element.country_txt)] == null){
       terroristData[processCountryNames(element.country_txt)] = [element];
       countryAtacks[processCountryNames(element.country_txt)] = {};
       countryAtacks[processCountryNames(element.country_txt)][element.iyear] = 1;
     }
     else{
        terroristData[processCountryNames(element.country_txt)].push(element);
        if(countryAtacks[processCountryNames(element.country_txt)][element.iyear] == null){
          countryAtacks[processCountryNames(element.country_txt)][element.iyear] = 1;
        }
        else{

          countryAtacks[processCountryNames(element.country_txt)][element.iyear] =  countryAtacks[processCountryNames(element.country_txt)][element.iyear] + 1;
          //console.log(countryAtacks[processCountryNames(element.country_txt)][element.iyear]);
        }
      }
    });

  console.log(terroristData);
  console.log(getAttackArray(countryAtacks['Afghanistan']));
  var afghAtacksYear = getAttackArray(countryAtacks['Afghanistan']);
  x.domain(d3.extent(afghAtacksYear, function(d) { return d.year; }));
  y.domain(d3.extent(afghAtacksYear, function(d) { return d.nrAttacks; }));

  g.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x))
      .select(".domain")
      //.remove();

  g.append("g")
      .call(d3.axisLeft(y))
    .append("text")
      .attr("fill", "#000")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", "0.71em")
      .attr("text-anchor", "end")
      .text("NÂº Attacks");

  g.append("path")
      .datum(afghAtacksYear)
      .attr("fill", "none")
      .attr("stroke", "steelblue")
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width", 1.5)
      .attr("d", line);
});

</script>
